pipeline {
    agent any
    tools {
        maven "Maven"
      }

    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Example') {
            steps {
                echo 'Hello World'
            writeFile file: "/tmp/app-devops-jenkins-${env.BUILD_NUMBER}-SNAPSHOT.jar", text: 'This is a test'
            writeFile file: "/tmp/app-devops-jenkins2-${env.BUILD_NUMBER}-SNAPSHOT.jar", text: 'This is a test'
    
            }
            
            post { 
                always { 
        script { 
                 def server = Artifactory.server 'jfrognew'
                 def uploadSpec = """{
                    "files": [{
                       "pattern": "/tmp/app-devops-jenkins-${env.BUILD_NUMBER}-SNAPSHOT.jar",
                       "target": "tf-trial//${env.BUILD_NUMBER}/"
                    }]
                 }"""

              def buildInfo = server.upload(uploadSpec) 
              server.publishBuildInfo buildInfo   
        }}
       }
       
      }
        stage('Download Artifact') {
            steps {
                 script { 
                    def server = Artifactory.server('jfrognew')
                    def downSpec = """{
                        "files": [{
                            "pattern": "tf-trial/5/EnterpriseDevops-0.0.1-SNAPSHOT.jar",
                            "target": "/var/jenkins_home/workspace/ArtifactsToDeploy/${env.BUILD_NUMBER}/",
                            "props": "latest=true"
                        }]
                    }"""
                
                    def buildInfo = server.download(downSpec)
                    server.publishBuildInfo(buildInfo)
                }
            }
        }
    }
}
